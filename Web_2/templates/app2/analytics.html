{% extends "base.html" %}
{% block css %}
  <!-- Google Fonts for a modern look -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
{% endblock %}
{% block content %}
<div class="dashboard-container">
  <h1>Analytics Dashboard</h1>

  <!-- Filter Form -->
  <form method="get" class="filter-form">
    <div class="form-row">
      <div class="form-group">
        <label for="batch">Batch:</label>
        <select name="batch" id="batch">
          <option value="">All Batches</option>
          {% for b in batches %}
            <option value="{{ b }}" {% if selected_batch == b %}selected{% endif %}>{{ b }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="semester">Semester:</label>
        <select name="semester" id="semester">
          <option value="">All Semesters</option>
          {% for s in semesters %}
            <option value="{{ s }}" {% if selected_semester == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="year">Year:</label>
        <select name="year" id="year">
          <option value="">All Years</option>
          {% for y in years %}
            <option value="{{ y }}" {% if selected_year == y %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="section">Section:</label>
        <select name="section" id="section">
          <option value="">All Sections</option>
          {% for s in sections %}
            <option value="{{ s }}" {% if selected_section == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="start_date">Start Date:</label>
        <input type="date" name="start_date" id="start_date" value="{{ selected_start_date }}">
      </div>
      <div class="form-group">
        <label for="end_date">End Date:</label>
        <input type="date" name="end_date" id="end_date" value="{{ selected_end_date }}">
      </div>
      <div class="form-group">
        <label for="student_id">Search Student ID:</label>
        <input type="text" name="student_id" id="student_id" placeholder="Enter Student ID">
      </div>
      
    </div>
    <button type="submit" class="btn">Apply Filters</button>
  </form>

  {% if student_heatmap %}
  <div class="chart">
    <h2>Student Attendance Heatmap</h2>
    {{ student_heatmap | safe }}
  </div>
  {% endif %}
  

  <!-- Metrics Section -->
  <div class="metrics">
    <div class="metric-card">
      <h3>Total Entries</h3>
      <p>{{ total_entries }}</p>
    </div>
    <div class="metric-card">
      <h3>Total Exits</h3>
      <p>{{ total_exits }}</p>
    </div>
    <div class="metric-card">
      <h3>Unique Students</h3>
      <p>{{ unique_students }}</p>
    </div>
    <div class="metric-card">
      <h3>Students Currently Inside</h3>
      <p>{{ students_inside }}</p>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts">
    {% if plot_hourly  %}
    <div class="chart">
      <h2>Hourly Activity</h2>
      {{ plot_hourly | safe }}
    </div>
    {% endif %}
    {% if plot_daily  %}
    <div class="chart">
      <h2>Daily Activity</h2>
      {{ plot_daily | safe }}
    </div>
    {% endif %}
    {% if plot_pie %}
    <div class="chart">
      <h2>Entry vs Exit Distribution</h2>
      {{ plot_pie | safe }}
    </div>
    {% endif %}
    {% if plot_monthly %}
    <div class="chart">
      <h2>Monthly Attendance Trends</h2>
      {{ plot_monthly | safe }}
    </div>
    {% endif %}
    {% if plot_batch %}
    <div class="chart">
      <h2>Attendance by Batch</h2>
      {{ plot_batch | safe }}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
